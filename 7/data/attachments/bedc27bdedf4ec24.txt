# Instructions

- Following Playwright test failed.
- Explain why, be concise, respect Playwright best practices.
- Provide a snippet of code with the fix, if possible.

# Test info

- Name: i18n Accessibility Tests >> should maintain accessibility in es language and verify resilient locators
- Location: /home/runner/work/test-automation-best-practices/test-automation-best-practices/e2e/tests/a11y.spec.ts:84:9

# Error details

```
Error: Timed out 5000ms waiting for expect(locator).toBeVisible()

Locator: getByRole('button', { name: 'Turquesa' })
Expected: visible
Received: <element(s) not found>
Call log:
  - expect.toBeVisible with timeout 5000ms
  - waiting for getByRole('button', { name: 'Turquesa' })

    at /home/runner/work/test-automation-best-practices/test-automation-best-practices/e2e/tests/a11y.spec.ts:95:84
```

# Page snapshot

```yaml
- main:
  - combobox "Seleccionar Idioma":
    - option "English"
    - option "Español" [selected]
    - option "Ελληνικά"
  - img "logo"
  - heading "Aplicación de elección de color" [level=1]
  - paragraph:
    - text: Edita
    - code: src/App.js
    - text: y guarda para recargar.
  - link "Aprender React"
  - text: "Color actual: #1abc9c"
  - paragraph: Loading colors...
```

# Test source

```ts
   1 | import { test, expect } from "../baseFixtures";
   2 | import { HomePage } from "../pages/HomePage";
   3 | import AxeBuilder from "@axe-core/playwright";
   4 |
   5 | /**
   6 |  * Test Suite: Accessibility Tests
   7 |  * 
   8 |  * This suite demonstrates how to use @axe-core/playwright to run accessibility 
   9 |  * audits against the DOM. It ensures that the application complies with 
   10 |  * accessibility WCAG guidelines.
   11 |  */
   12 | test.describe("Accessibility Tests", () => {
   13 |   let homePage: HomePage;
   14 |
   15 |   test.beforeEach(async ({ page }) => {
   16 |     homePage = new HomePage(page);
   17 |     await homePage.goto();
   18 |   });
   19 |
   20 |   /**
   21 |    * Test: Automatically detectable accessibility issues
   22 |    * 
   23 |    * Scans the initial page state for any accessibility violations, ensuring
   24 |    * that elements like headings, ARIA tags, and contrast are compliant.
   25 |    */
   26 |   test("should not have any automatically detectable accessibility issues", async ({
   27 |     page,
   28 |   }) => {
   29 |     // Wait for the main elements to render
   30 |     await expect(homePage.header).toBeVisible();
   31 |
   32 |     // Run Axe to check for accessibility violations
   33 |     const accessibilityScanResults = await new AxeBuilder({ page }).analyze();
   34 |
   35 |     // Verify there are no violations
   36 |     expect(accessibilityScanResults.violations).toEqual([]);
   37 |   });
   38 |
   39 |   /**
   40 |    * Test: Accessibility after state change
   41 |    * 
   42 |    * Verifies that the application remains accessible after user interactions,
   43 |    * specifically ensuring that color contrast ratios remain valid when the 
   44 |    * background color changes dynamically.
   45 |    */
   46 |   test("should maintain accessibility after state change (color update)", async ({
   47 |     page,
   48 |   }) => {
   49 |     // Change color to verify contrast and other rules still pass
   50 |     await homePage.clickColorButton("Yellow");
   51 |     
   52 |     // Wait for the color change to apply (indicated by the text changing)
   53 |     await expect(homePage.currentColorText).toContainText("#f1c40f");
   54 |
   55 |     const accessibilityScanResults = await new AxeBuilder({ page }).analyze();
   56 |
   57 |     // We specifically check contrast rules after a background color change
   58 |     const contrastViolations = accessibilityScanResults.violations.filter(
   59 |       (v) => v.id === "color-contrast"
   60 |     );
   61 |     expect(contrastViolations).toEqual([]);
   62 |   });
   63 | });
   64 |
   65 | import enTranslations from "../../src/locales/en.json";
   66 | import esTranslations from "../../src/locales/es.json";
   67 | import elTranslations from "../../src/locales/el.json";
   68 |
   69 | /**
   70 |  * Test Suite: i18n Accessibility Tests
   71 |  * 
   72 |  * Demonstrates best practices for handling multiple languages without 
   73 |  * relying on brittle DOM manipulation locators. By importing the language 
   74 |  * JSON directly, we can use resilient user-centric locators.
   75 |  */
   76 | test.describe("i18n Accessibility Tests", () => {
   77 |   const languages = [
   78 |     { code: "en", i18n: enTranslations },
   79 |     { code: "es", i18n: esTranslations },
   80 |     { code: "el", i18n: elTranslations },
   81 |   ];
   82 |
   83 |   for (const lang of languages) {
   84 |     test(`should maintain accessibility in ${lang.code} language and verify resilient locators`, async ({ page }) => {
   85 |       const homePage = new HomePage(page);
   86 |       await homePage.goto();
   87 |
   88 |       // Change the language. Default is English, so the label starts as English.
   89 |       const languageDropdown = page.getByRole("combobox", { name: enTranslations.languageSelector });
   90 |       await languageDropdown.selectOption(lang.code);
   91 |
   92 |       // Verify page layout using dynamic, translation-aware accessibility locators!
   93 |       // This is the clean, resilient way over falling back to CSS selectors.
   94 |       await expect(page.getByRole("heading", { name: lang.i18n.title })).toBeVisible();
>  95 |       await expect(page.getByRole("button", { name: lang.i18n.colors.turquoise })).toBeVisible();
      |                                                                                    ^ Error: Timed out 5000ms waiting for expect(locator).toBeVisible()
   96 |       await expect(page.getByRole("button", { name: lang.i18n.colors.red })).toBeVisible();
   97 |       await expect(page.getByRole("button", { name: lang.i18n.colors.yellow })).toBeVisible();
   98 |
   99 |       // Run Axe to check for accessibility violations in the translated state
  100 |       const accessibilityScanResults = await new AxeBuilder({ page }).analyze();
  101 |       expect(accessibilityScanResults.violations).toEqual([]);
  102 |     });
  103 |   }
  104 | });
  105 |
```